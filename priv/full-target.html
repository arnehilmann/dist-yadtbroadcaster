<html>
  <head>
    <link type="text/css" rel="stylesheet" href="/static/font-awesome-4.2.0/css/font-awesome.css"></link>
    <link type="text/css" rel="stylesheet" href="/static/yadt.css"></link>
    <style>
      .fa-exclamation-triangle { color: red; }
      .fa-check-circle { color: green; }
    </style>
    <script src="/static/jquery.min.js"></script>
    <script src="/static/d3.min.js"></script>
    <script>
      $.extend({
          getUrlVars: function(){
              var vars = [], hash;
              var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
              for(var i = 0; i < hashes.length; i++) {
                  hash = hashes[i].split('=');
                  vars.push(hash[0]);
                  vars[hash[0]] = hash[1];
              }
              return vars;
          },
          getUrlVar: function(name){
              return $.getUrlVars()[name];
          }
      });
    </script>
  </head>
  <body>
  <h1>Target <span class="targetname"></span></h1>
  <div id="hosts">
  </div>

    <script>
      var target = $.getUrlVar('target');
      var url = "/status/targets/" + target + "/full";
      d3.select(".targetname").text(target);

      var model = [];
      $.ajax({url: url,
        type: "GET",
        contentType: 'text/plain'
      })
        .done(function(data, status){
            console.log(data);
            model = JSON.parse(data);
            var hosts = d3.select("#hosts").selectAll("div").data(model);
            hosts.enter()
              .append("div")
              .append("h2")
              .text(function(d){return d.host;});
            var services = hosts.selectAll("p").data(function(d){return d.services;});
            var ps = services.enter().append("p");
            ps.append("i").attr("class", function(d){return d.state == "up" ? "fa fa-check-circle" : "fa fa-exclamation-triangle";});
            ps.append("span").text(function(d){return d.name;});
        })
        .fail(function(xhr, status){
            console.log(xhr);
            console.log(status);
        });
    </script>
  </body>
</html>
